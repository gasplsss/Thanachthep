<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚Ä¢ LOOK UP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--bg:#f7f7f8;--card:#fff;--line:#e5e7eb;--text:#111827;--muted:#6b7280;--accent:#2563eb;--danger:#ef4444;--ok:#16a34a}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--text)}
    header{padding:14px 16px;border-bottom:1px solid var(--line);background:#fff}
    header b{letter-spacing:.3px}
    main{max-width:840px;margin:18px auto;padding:0 16px 40px}
    .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:18px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    label{display:block;margin:6px 0 6px;color:#374151;font-weight:600}
    input,select,button,textarea{font:inherit}
    input,select,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff}
    textarea{min-height:90px}
    .row{display:flex;gap:10px;align-items:center}
    .muted{color:var(--muted);font-size:12px}
    .error{color:#fff;background:var(--danger);padding:8px 10px;border-radius:10px;margin-top:10px;display:none}
    .btn{appearance:none;border:0;border-radius:10px;padding:12px 14px;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:#fff;border:1px solid var(--accent);color:var(--accent)}
    .btn.ok{background:var(--ok);color:#fff}
    .actions{display:flex;gap:10px;justify-content:space-between;margin-top:14px;flex-direction:row-reverse}

    /* Modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:50}
    .backdrop.show{display:flex}
    .modal{background:#fff;border:1px solid var(--line);border-radius:16px;max-width:420px;width:92%;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.12)}
    .modal h3{margin:0 0 8px}
    .modal p{margin:0 0 14px;color:#374151}
    .modal .row{justify-content:flex-end}
  </style>
</head>
<body>
  <header><b>LOOK UP ‚Ä¢ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</b></header>

  <main>
    <div class="card">
      <div class="grid">
        <div>
          <label>‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤</label>
          <select id="prefix">
            <option value="‡∏Ñ‡∏∏‡∏ì">‡∏Ñ‡∏∏‡∏ì</option>
            <option value="‡∏ô‡∏≤‡∏¢">‡∏ô‡∏≤‡∏¢</option>
            <option value="‡∏ô‡∏≤‡∏á">‡∏ô‡∏≤‡∏á</option>
            <option value="‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß">‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß</option>
            <option value="_other">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)</option>
          </select>
          <input id="prefix_other" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏≠‡∏á" class="muted" style="margin-top:8px;display:none">
        </div>

        <div>
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
          <input id="phone" inputmode="numeric" maxlength="10" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678">
          <div class="muted">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å</div>
        </div>

        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠</label>
          <input id="first_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á">
        </div>

        <div>
          <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input id="last_name" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
        </div>

        <div>
          <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
          <input id="email" type="email" placeholder="name@example.com" autocomplete="username">
        </div>

        <div>
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <div class="row">
            <input id="password" type="password" placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£" autocomplete="new-password" style="flex:1">
            <button type="button" class="btn ghost" onclick="togglePw('password', this)">‡πÅ‡∏™‡∏î‡∏á</button>
          </div>
        </div>

        <div>
          <label>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <div class="row">
            <input id="password2" type="password" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ã‡πâ‡∏≥‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á" autocomplete="new-password" style="flex:1">
            <button type="button" class="btn ghost" onclick="togglePw('password2', this)">‡πÅ‡∏™‡∏î‡∏á</button>
          </div>
        </div>

        <div>
          <label>‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà / ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
          <input id="addr1" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏´‡∏°‡∏π‡πà/‡∏ã‡∏≠‡∏¢ ‡∏ñ‡∏ô‡∏ô">
        </div>

        <div>
          <label>‡∏ï‡∏≥‡∏ö‡∏•</label>
          <input id="subdistrict" placeholder="‡∏ï‡∏≥‡∏ö‡∏•/‡πÅ‡∏Ç‡∏ß‡∏á">
        </div>

        <div>
          <label>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
          <input id="district" placeholder="‡∏≠‡∏≥‡πÄ‡∏†‡∏≠/‡πÄ‡∏Ç‡∏ï">
        </div>

        <div>
          <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
          <input id="province" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î">
        </div>

        <div>
          <label>‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</label>
          <input id="zipcode" inputmode="numeric" maxlength="5" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10210">
        </div>
      </div>

      <div id="err" class="error"></div>

      <div class="actions">
        <a class="btn ghost" href="/login.html">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        <button id="btnSubmit" class="btn primary" onclick="submitForm()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
      </div>
    </div>

    <section style="margin-top:12px" class="muted">
      * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á)
    </section>
  </main>

  <!-- Success Modal -->
  <div id="successBox" class="backdrop" role="dialog" aria-modal="true" aria-labelledby="successTitle">
    <div class="modal">
      <h3 id="successTitle">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ</h3>
      <p>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
      <div class="row">
        <button class="btn ghost" onclick="closeSuccess()">‡∏õ‡∏¥‡∏î</button>
        <a class="btn ok" href="/login.html">‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
      </div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const REGISTER_ENDPOINT = '/api/auth/register';

    // ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
    $('prefix').addEventListener('change', () => {
      $('prefix_other').style.display = ($('prefix').value === '_other') ? 'block' : 'none';
    });

    // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ö‡∏≠‡∏£‡πå/‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
    $('phone').addEventListener('input', e => { e.target.value = e.target.value.replace(/\D+/g,'').slice(0,10); });
    $('zipcode').addEventListener('input', e => { e.target.value = e.target.value.replace(/\D+/g,'').slice(0,5); });

    function togglePw(id, btn){
      const el = $(id);
      el.type = (el.type === 'password') ? 'text' : 'password';
      btn.textContent = (el.type === 'password') ? '‡πÅ‡∏™‡∏î‡∏á' : '‡∏ã‡πà‡∏≠‡∏ô';
    }

    function showErr(msg){
      const box = $('err');
      box.textContent = msg;
      box.style.display = msg ? 'block' : 'none';
    }

    function buildAddress(){
      const parts = [];
      if ($('addr1').value.trim()) parts.push($('addr1').value.trim());
      const loc = [
        $('subdistrict').value.trim() ? '‡∏ï.' + $('subdistrict').value.trim() : '',
        $('district').value.trim()    ? '‡∏≠.' + $('district').value.trim()    : '',
        $('province').value.trim()    ? '‡∏à.' + $('province').value.trim()    : ''
      ].filter(Boolean).join(' ');
      if (loc) parts.push(loc);
      if ($('zipcode').value.trim()) parts.push($('zipcode').value.trim());
      return parts.join(' ');
    }

    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á + ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    function clearForm(){
      $('prefix').value = '‡∏Ñ‡∏∏‡∏ì';
      $('prefix_other').value = '';
      $('prefix_other').style.display = 'none';

      ['phone','first_name','last_name','email','password','password2','addr1','subdistrict','district','province','zipcode']
        .forEach(id => $(id).value = '');

      showErr('');
      const btn = $('btnSubmit'); btn.disabled = false; btn.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
    }

    function openSuccess(){
      $('successBox').classList.add('show');
    }
    function closeSuccess(){
      $('successBox').classList.remove('show');
    }

    async function submitForm(){
      showErr('');
      const btn = $('btnSubmit');
      btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£...';

      try {
        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤
        const prefix = $('prefix').value === '_other'
          ? ($('prefix_other').value.trim() || '‡∏Ñ‡∏∏‡∏ì')
          : $('prefix').value;

        const first = $('first_name').value.trim();
        const last  = $('last_name').value.trim();
        const phone = $('phone').value.trim();
        const email = $('email').value.trim();
        const pw1   = $('password').value;
        const pw2   = $('password2').value;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
        if (!first || !last)          return showErr('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'), resetBtn();
        if (!email || !/^\S+@\S+\.\S+$/.test(email)) return showErr('‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'), resetBtn();
        if (phone.length !== 10)      return showErr('‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å'), resetBtn();
        if (!pw1 || pw1.length < 6)   return showErr('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£'), resetBtn();
        if (pw1 !== pw2)              return showErr('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô'), resetBtn();

        const full_name = `${prefix} ${first} ${last}`.trim();
        const address   = buildAddress();

        const payload = { full_name, email, password: pw1, phone, address };

        const r = await fetch(REGISTER_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
          credentials: 'include'
        });

        const data = await r.json().catch(()=> ({}));

        if (!r.ok) {
          showErr(data.message || '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          return resetBtn();
        }

        // ‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏° + ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ
        clearForm();
        openSuccess();

      } catch (err) {
        showErr('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö');
        resetBtn();
      }

      function resetBtn(){
        btn.disabled = false; btn.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
      }
    }
    function clearForm(){
  $('prefix').value = '‡∏Ñ‡∏∏‡∏ì';
  $('prefix_other').value = '';
  $('prefix_other').style.display = 'none';
  ['phone','first_name','last_name','email','password','password2',
   'addr1','subdistrict','district','province','zipcode']
    .forEach(id => $(id).value = '');
  showErr('');
  const btn = $('btnSubmit');
  btn.disabled = false;
  btn.textContent = '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
}

function openSuccess(){
  alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login ‡∏ï‡πà‡∏≠‡πÉ‡∏™‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
  // location.href = '/login.html';
}

  </script>
</body>
</html>
