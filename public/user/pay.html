<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‚Ä¢ LOOK UP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ========= THEME ========= */
    :root{
      --bg:#f6f7fb;--card:#fff;--line:#e7e9ef;--text:#0f172a;--muted:#64748b;
      --accent:#2563eb;--danger:#ef4444;--success:#16a34a;--warn:#f59e0b;
      --radius:14px;--radius-sm:10px;--shadow:0 2px 8px rgba(15,23,42,.06),0 12px 24px rgba(15,23,42,.06);
      --focus:0 0 0 3px rgba(37,99,235,.25)
    }
    @media (prefers-color-scheme: dark){
      :root{--bg:#0b1020;--card:#0f1528;--line:#20263a;--text:#e5e7eb;--muted:#94a3b8;--shadow:0 2px 12px rgba(0,0,0,.5),0 20px 40px rgba(0,0,0,.35)}
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--text)}

    /* ========= HEADER ========= */
    header{position:sticky;top:0;z-index:10;display:flex;gap:10px;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line);backdrop-filter:blur(8px);background:color-mix(in oklab,var(--card) 92%, transparent)}
    header .sp{flex:1}
    a.btn,button.btn{appearance:none;border:1px solid var(--line);border-radius:var(--radius-sm);padding:10px 14px;font-weight:800;cursor:pointer;text-decoration:none;display:inline-block;transition:.18s ease;box-shadow:var(--shadow);background:#fff;color:var(--text)}
    .btn.primary{border-color:transparent;background:var(--accent);color:#fff}
    .btn:focus-visible{outline:none;box-shadow:var(--focus),var(--shadow)}

    main{max-width:980px;margin:14px auto;padding:0 14px 80px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
    .muted{color:var(--muted)}

    /* ========= ORDER BOX ========= */
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--line);font-weight:800;font-size:12px}
    .pill.ok{background:#eaf9ef;border-color:#bbf7d0;color:#065f46}
    .pill.warn{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
    .pill.bad{background:#fee2e2;border-color:#fecaca;color:#991b1b}

    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{font-size:12px;color:var(--muted);font-weight:800;padding:0 10px}
    tbody tr{background:var(--card);box-shadow:var(--shadow)}
    tbody td{padding:12px 10px;border-top:1px solid var(--line);border-bottom:1px solid var(--line);vertical-align:middle}
    tbody tr td:first-child{border-left:1px solid var(--line);border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody tr td:last-child{border-right:1px solid var(--line);border-top-right-radius:12px;border-bottom-right-radius:12px}

    img.item{width:56px;height:56px;object-fit:cover;border-radius:10px;border:1px solid var(--line)}

    /* ========= QR / UPLOAD ========= */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:780px){.grid{grid-template-columns:1fr}}

    .qr{width:240px;max-width:100%;height:auto;border:1px solid var(--line);border-radius:12px}

    .drop{
      border:1px dashed var(--line);border-radius:12px;padding:14px;
      display:flex;gap:12px;align-items:center;justify-content:center;min-height:120px;
      background:#fafbff; cursor:pointer; user-select:none;
      outline:0;
    }
    .drop:hover{background:#f3f6ff}
    .drop.drag{background:#eef2ff}
    .drop:focus-visible{box-shadow:var(--focus)}
    .preview{max-width:260px;max-height:260px;border-radius:12px;border:1px solid var(--line)}

    .row{display:flex;gap:10px;flex-wrap:wrap}

    /* ========= TOAST ========= */
    .toast-wrap{position:fixed;right:16px;bottom:16px;display:grid;gap:10px;z-index:50}
    .toast{background:var(--card);border:1px solid var(--line);box-shadow:var(--shadow);padding:12px 14px;border-radius:12px;font-weight:700}

    /* ========= SKELETON ========= */
    .sk{position:relative;overflow:hidden;background:color-mix(in oklab,#cfd7e7 20%, #fff);border-radius:10px}
    .sk::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent);transform:translateX(-100%);animation:sh 1.2s infinite}
    @keyframes sh{to{transform:translateX(100%)}}

    /* ========= MODAL (THANK YOU) ========= */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);display:none;place-items:center;z-index:100}
    .modal{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);width:min(520px,92vw);padding:18px;text-align:center}
    .modal h3{margin:0 0 6px}
    .modal p{margin:4px 0 14px}
    .modal .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  </style>
</head>
<body>
<header>
  <button class="btn" onclick="goCart()">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
  <div class="sp"></div>
  <b>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</b>
  <div class="sp"></div>
  <a class="btn" href="/user/orders.html">‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
</header>

<main>
  <div id="orderBox" class="card">
    <div class="sk" style="height:18px;width:40%"></div>
    <div class="sk" style="height:12px;width:30%;margin-top:8px"></div>
    <div class="sk" style="height:120px;width:100%;margin-top:12px;border-radius:12px"></div>
  </div>

  <div class="grid">
    <div class="card">
      <h3 style="margin:0 0 10px">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô QR</h3>
      <img id="qrImg" class="qr" src="/uploads/QRcode-p.jpg" alt="QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô">
      <div class="row" style="margin-top:10px">
        <a id="saveBtn" class="btn" download="lookup_qr.png" href="/uploads/QRcode-p.jpg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ QR</a>
        <button class="btn" onclick="openQR()">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà</button>
      </div>
      <div class="muted" style="margin-top:6px">‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡∏∞‡πÇ‡∏≠‡∏ô‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤</div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 10px">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</h3>

      <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå -->
      <div id="drop"
           class="drop"
           role="button"
           tabindex="0"
           aria-label="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ß‡∏≤‡∏á"
           ondragover="evDrag(event,true)"
           ondragleave="evDrag(event,false)"
           ondrop="evDrop(event)">
        <div>
          <div style="font-weight:800">‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</div>
          <div class="muted" style="margin-top:6px">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG/PNG ‡∏Ç‡∏ô‡∏≤‡∏î ‚â§ 8MB</div>
        </div>

        <!-- input ‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ -->
        <input id="slip" type="file" accept="image/*" style="display:none" onchange="pickFile(this.files[0])">
      </div>

      <div id="previewWrap" class="row" style="margin-top:10px;display:none">
        <img id="preview" class="preview" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏•‡∏¥‡∏õ">
        <button class="btn" type="button" onclick="document.getElementById('slip').click()">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô</button>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="uploadBtn" class="btn primary" onclick="uploadSlip()">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
      </div>
      <div class="muted" style="margin-top:6px">* ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô <b>pending</b> ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
    </div>
  </div>
</main>

<!-- THANK YOU MODAL -->
<div id="doneModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="doneTitle" aria-describedby="doneDesc">
  <div class="modal">
    <h3 id="doneTitle">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ üéâ</h3>
    <p id="doneDesc" class="muted">‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ <b id="doneOrderId">#-</b> ‡πÅ‡∏•‡πâ‡∏ß<br>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô <b>pending</b> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô üôè</p>
    <div class="actions">
      <button class="btn" onclick="goHome()">üè† ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
      <a id="goOrders" class="btn primary" href="/user/orders.html">üì¶ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‚Äù</a>
    </div>
  </div>
</div>

<div id="toasts" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

<script>
  const $ = s => document.querySelector(s);
  const orderId = new URLSearchParams(location.search).get('id') || localStorage.getItem('last_order_id');
  if(!orderId){ alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠'); location.href='/user/orders.html'; }

  const fmt = n => (Number(n)||0).toLocaleString('th-TH');
  const toast = (m)=>{ const w=$('#toasts'); const t=document.createElement('div'); t.className='toast'; t.textContent=m; w.appendChild(t); setTimeout(()=>{t.style.opacity='0'; setTimeout(()=>t.remove(),260)}, 2200); };
  function goCart(){ location.href='/user/cart.html'; }
  function openQR(){ window.open($('#qrImg').src, '_blank'); }
  function goHome(){ location.href='/user/user.html'; }

  function pillClass(s){ s = String(s||'').toLowerCase();
    if(s.includes('paid')||s.includes('‡∏ä‡∏≥‡∏£‡∏∞')) return 'pill ok';
    if(s.includes('pending')||s.includes('‡∏£‡∏≠')) return 'pill warn';
    if(s.includes('cancel')) return 'pill bad';
    return 'pill';
  }

  // Modal helpers
  function openDoneModal(){
    document.getElementById('doneOrderId').textContent = '#'+orderId;
    const m = document.getElementById('doneModal');
    m.style.display = 'grid';
    document.body.style.overflow = 'hidden';
    // focus primary action
    setTimeout(()=> document.getElementById('goOrders').focus(), 0);
  }
  function closeDoneModal(){
    const m = document.getElementById('doneModal');
    m.style.display = 'none';
    document.body.style.overflow = '';
  }
  // Close on ESC / click backdrop
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeDoneModal(); });
  document.getElementById('doneModal').addEventListener('click', (e)=>{ if(e.target.id==='doneModal') closeDoneModal(); });

  // debug no-op
  function setOut(){}

  async function loadOrder(){
    try{
      const r = await fetch('/api/user/orders/'+orderId, { credentials:'include' });
      if(r.status===401){ location.href='/login.html'; return; }
      const d = await r.json();
      if(!r.ok){ alert(d.message || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠'); location.href='/user/orders.html'; return; }
      setOut(d);

      const itemsHtml = (d.items||[]).map(it=>`
        <tr>
          <td style="width:70px"><img src="${it.image_url||'/uploads/noimg.png'}" class="item" alt=""></td>
          <td>${it.name||'-'} <span class="muted">‡∏£‡∏∏‡πà‡∏ô ${it.model||'-'}</span></td>
          <td>${fmt(it.qty)}</td>
          <td>${fmt(it.price)}</td>
          <td>${fmt(it.qty*it.price)}</td>
        </tr>
      `).join('');

      $('#orderBox').innerHTML = `
        <div><b>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ #${d.order.id}</b> | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span class="${pillClass(d.order.status)}">${d.order.status}</span></div>
        <div class="muted">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(d.order.created_at).toLocaleString('th-TH')}</div>
        <table style="margin-top:10px">
          <thead><tr><th></th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏£‡∏ß‡∏°</th></tr></thead>
          <tbody>${itemsHtml}</tbody>
          <tfoot><tr><td colspan="4" style="text-align:right"><b>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</b></td><td>${fmt(d.order.total)}</td></tr></tfoot>
        </table>
        <div style="margin-top:10px">
          <div><b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</b> ${d.order.recipient_name||'-'} ‚Äî ${d.order.ship_phone||'-'}</div>
          <div class="muted">${d.order.ship_address||'-'} ${d.order.ship_subdistrict||''} ${d.order.ship_district||''} ${d.order.ship_province||''} ${d.order.ship_zipcode||''}</div>
        </div>
        ${d.payment && d.payment.payment_image ? `<div style="margin-top:10px"><b>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</b><br><img src="${d.payment.payment_image}" style="max-width:320px;border:1px solid var(--line);border-radius:8px"></div>` : ''}
      `;
    }catch(e){ console.error(e); alert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }
  }

  // ===== Upload slip =====
  let pickedFile = null;

  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡∏¥‡∏î File Picker ‡πÑ‡∏î‡πâ
  document.addEventListener('DOMContentLoaded', ()=>{
    const drop = document.getElementById('drop');
    const file = document.getElementById('slip');

    drop.addEventListener('click', (e)=>{
      if (e.target.closest('a,button,label')) return;
      file.click();
    });

    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
    drop.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault();
        file.click();
      }
    });
  });

  function evDrag(e, on){ e.preventDefault(); document.getElementById('drop').classList.toggle('drag', !!on); }
  function evDrop(e){ e.preventDefault(); document.getElementById('drop').classList.remove('drag'); const f=e.dataTransfer.files?.[0]; if(f) pickFile(f); }

  function pickFile(f){
    if(!f) return;
    if(!/^image\//.test(f.type))   return alert('‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û');
    if(f.size>8*1024*1024)         return alert('‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 8MB');
    pickedFile = f;
    const url = URL.createObjectURL(f);
    document.getElementById('preview').src = url;
    document.getElementById('previewWrap').style.display='flex';
  }

  async function uploadSlip(){
    const domFile = document.getElementById('slip').files[0];
    if(!pickedFile && !domFile){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô'); return; }
    const f = pickedFile || domFile;

    const btn = document.getElementById('uploadBtn'); btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‚Ä¶';
    try{
      const fd = new FormData(); fd.append('order_id', orderId); fd.append('payment_image', f);
      const r = await fetch('/api/user/payments', { method:'POST', body:fd, credentials:'include' });
      const d = await r.json(); setOut(d);
      if(r.status===401){ location.href='/login.html'; return; }
      if(r.ok){
        toast('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        pickedFile=null; document.getElementById('slip').value=''; document.getElementById('previewWrap').style.display='none';
        loadOrder();
        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì
        openDoneModal();
      }else{
        alert(d.message || '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      }
    }catch(e){
      console.error(e); alert('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }finally{
      btn.disabled = false; btn.textContent = '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';
    }
  }

  loadOrder();
</script>
</body>
</html>
