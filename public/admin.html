<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>Admin ‚Ä¢ LOOK UP</title>
  <style>
    :root{
      --bg:#f7f7f8;--card:#ffffff;--line:#e9e9ee;--text:#111827;--muted:#6b7280;--brand:#0f172a;
      --accent:#2563eb;--ok:#16a34a;--warn:#f59e0b;--danger:#ef4444;
      --radius:14px;--radius-sm:10px;--shadow:0 2px 8px rgba(15,23,42,.06),0 12px 24px rgba(15,23,42,.06);
      --focus:0 0 0 3px rgba(37,99,235,.25)
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--text)}

    /* Header */
    header{position:sticky;top:0;z-index:10;display:flex;gap:10px;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line);backdrop-filter:blur(8px);background:color-mix(in oklab,var(--card) 92%, transparent)}
    header h1{margin:0;font-size:18px;letter-spacing:.2px;color:var(--brand)}
    header .sp{flex:1}

    /* Tabs */
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{appearance:none;border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 12px;font-weight:800;cursor:pointer;box-shadow:var(--shadow);transition:.18s ease}
    .tab.active{border-color:transparent;background:var(--accent);color:#fff}

    /* Dropdown menu */
    .chip{appearance:none;border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 12px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:8px;box-shadow:var(--shadow)}
    .chip:focus-visible{outline:none;box-shadow:var(--focus),var(--shadow)}
    .menu-wrap{position:relative}
    #menu{position:absolute;right:0;top:44px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);width:240px;padding:8px;display:none;z-index:20}
    #menu a,#menu button{display:flex;align-items:center;gap:10px;width:100%;background:transparent;border:0;padding:10px 12px;border-radius:10px;text-decoration:none;color:var(--text);cursor:pointer;font-weight:700}
    #menu a:hover,#menu button:hover{background:#f8fafc}

    /* Layout & controls */
    main{max-width:1200px;margin:16px auto;padding:0 16px 70px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);margin-top:12px}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 320px}
    .btn{padding:10px 14px;border:0;border-radius:10px;font-weight:800;cursor:pointer;box-shadow:var(--shadow)}
    .btn.ok{background:var(--ok);color:#fff}
    .btn.warn{background:var(--warn);color:#fff}
    .btn.danger{background:var(--danger);color:#fff}
    .btn.gray{background:#e5e7eb;color:#111827;border:1px solid var(--line)}
    .btn.outline{background:#fff;color:var(--accent);border:1px solid var(--accent)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    label{display:block;margin:8px 0 4px;font-weight:700;color:var(--muted)}
    input,select,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff}
    input:focus,select:focus,textarea:focus{outline:none;box-shadow:var(--focus)}
    textarea{min-height:90px}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#1f2937;font-size:12px;font-weight:800}
    img.thumb{width:56px;height:56px;object-fit:cover;border-radius:10px;border:1px solid var(--line)}
    .muted{color:var(--muted);font-size:12px}

    /* Tables */
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{font-size:12px;color:var(--muted);font-weight:800;padding:0 10px}
    tbody tr{background:var(--card);box-shadow:var(--shadow)}
    tbody td{padding:12px 10px;border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
    tbody tr td:first-child{border-left:1px solid var(--line);border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody tr td:last-child{border-right:1px solid var(--line);border-top-right-radius:12px;border-bottom-right-radius:12px}
    .hidden{display:none}
  </style>
</head>
<body>
  <header>
    <h1>Admin ‚Ä¢ LOOK UP</h1>

    <div class="sp"></div>

    <div class="tabs" role="tablist">
      <button class="tab active" id="tab-products" onclick="showSection('sec-products', this)">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      <button class="tab" id="tab-users" onclick="showSection('sec-users', this)">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
      <button class="tab" id="tab-orders" onclick="showSection('sec-orders', this)">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
      <button class="tab" id="tab-reports" onclick="showSection('sec-reports', this)">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    </div>

    <div class="sp"></div>

    <!-- Admin email + dropdown -->
    <div class="menu-wrap">
      <button class="chip" data-menu-btn onclick="toggleMenu()" aria-haspopup="menu" aria-expanded="false" title="‡πÄ‡∏°‡∏ô‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span id="adminEmail">admin@lookup</span>
      </button>
      <div id="menu" role="menu" aria-label="‡πÄ‡∏°‡∏ô‡∏π‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•">
        <button onclick="loadProfile()">üë§ ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</button>
        <button onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
    </div>
  </header>

  <main>
    <!-- PRODUCTS -->
    <section id="sec-products" class="card">
      <h2>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
      <div class="toolbar">
        <button class="btn" onclick="loadProducts()">üì¶ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        <button class="btn ok" onclick="toggle('box-add')">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        <button class="btn warn" onclick="toggle('box-edit')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      </div>

      <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
      <div id="box-add" class="card hidden">
        <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
        <div class="row">
          <div class="col">
            <label>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</label><select id="brand_create"></select>
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô/‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input id="name_create" placeholder="‡πÄ‡∏ä‡πà‡∏ô SAFARI UV 400 ‡∏£‡∏∏‡πà‡∏ô S0952">
            <label>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (SKU/Model)</label><input id="model_create" placeholder="‡πÄ‡∏ä‡πà‡∏ô S0952">
            <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ)</label><textarea id="desc_create"></textarea>
            <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÑ‡∏ü‡∏•‡πå)</label><input id="img_create" type="file" accept="image/*">
          </div>
          <div class="col">
            <label>‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏ß‡πà‡∏ô</label>
            <select id="shape_create"><option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option><option>Round</option><option>Square</option><option>Drop</option><option>Two Bar</option></select>
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÅ‡∏ß‡πà‡∏ô‡∏ï‡∏≤</label>
            <select id="type_create"><option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option><option>Eyeglasses</option><option>Sunglasses</option></select>
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏ô‡∏™‡πå (‡∏°‡∏°.)</label><input id="lens_create" type="number">
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏°‡∏π‡∏Å (‡∏°‡∏°.)</label><input id="bridge_create" type="number">
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≤ (‡∏°‡∏°.)</label><input id="temple_create" type="number">
            <label>‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡∏°‡∏°.)</label><input id="front_create" type="number">
          </div>
          <div class="col">
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><select id="status_create"><option value="in">‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option><option value="out">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î</option></select>
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ä‡∏¥‡πâ‡∏ô)</label><input id="qty_create" type="number" value="0">
            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label><input id="price_create" type="number" step="0.01">
            <label>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà?</label><select id="isnew_create"><option value="0">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</option><option value="1">‡πÉ‡∏ä‡πà</option></select>
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</label><input id="date_create" type="date">
            <div style="margin-top:10px"><button class="btn ok" onclick="createProduct()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button></div>
          </div>
        </div>
      </div>

      <!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö -->
      <div id="box-edit" class="card hidden">
        <h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
        <div class="row">
          <div class="col">
            <label>‡∏£‡∏∞‡∏ö‡∏∏ ID ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
            <div class="row" style="gap:8px">
              <input id="id_edit" type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1" style="flex:1 1 120px">
              <button class="btn gray" onclick="loadOneForEdit()">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
              <button id="btnArchive" class="btn warn" onclick="archiveProduct()">‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
              <button id="btnRestore" class="btn ok" onclick="restoreProduct()">‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
              <div class="muted" id="prodStatusNote" style="margin-top:6px">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: -</div>
            </div>

            <label>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</label><select id="brand_edit"></select>
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô/‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input id="name_edit">
            <label>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (SKU/Model)</label><input id="model_edit">
            <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><textarea id="desc_edit"></textarea>
            <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</label><input id="img_edit" type="file" accept="image/*">
          </div>
          <div class="col">
            <label>‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏ß‡πà‡∏ô</label>
            <select id="shape_edit"><option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option><option>Round</option><option>Square</option><option>Drop</option><option>Two Bar</option></select>
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÅ‡∏ß‡πà‡∏ô‡∏ï‡∏≤</label>
            <select id="type_edit"><option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option><option>Eyeglasses</option><option>Sunglasses</option></select>
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏ô‡∏™‡πå (‡∏°‡∏°.)</label><input id="lens_edit" type="number">
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏à‡∏°‡∏π‡∏Å (‡∏°‡∏°.)</label><input id="bridge_edit" type="number">
            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≤ (‡∏°‡∏°.)</label><input id="temple_edit" type="number">
            <label>‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡∏°‡∏°.)</label><input id="front_edit" type="number">
          </div>
          <div class="col">
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><select id="status_edit"><option value="in">‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option><option value="out">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î</option></select>
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ä‡∏¥‡πâ‡∏ô)</label><input id="qty_edit" type="number">
            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label><input id="price_edit" type="number" step="0.01">
            <label>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà?</label><select id="isnew_edit"><option value="0">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</option><option value="1">‡πÉ‡∏ä‡πà</option></select>
            <div style="margin-top:10px"><button class="btn warn" onclick="updateProduct()">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></div>
          </div>
        </div>
      </div>

      <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞") -->
      <div class="card">
        <table id="tblProducts">
          <thead>
            <tr>
              <th>ID</th><th>‡∏£‡∏π‡∏õ</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</th><th>‡∏™‡∏ï‡πä‡∏≠‡∏Å</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏î‡∏π/‡πÅ‡∏Å‡πâ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="muted" style="margin-top:6px">* ‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà ID ‡πÉ‡∏´‡πâ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
      </div>
    </section>

    <!-- USERS -->
    <section id="sec-users" class="card hidden">
      <h2>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
      <div class="toolbar">
        <button class="btn" onclick="loadUsers()">üë§ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
        <button class="btn gray" onclick="toggle('box-user-view')">üîé ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</button>
        <button class="btn warn" onclick="toggle('box-user-orders')">üßæ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
      </div>

      <div id="box-user-view" class="card hidden">
        <h3>üîç ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô</h3>
        <div class="row" style="gap:8px;align-items:center">
          <input id="u_id" type="number" placeholder="User ID" style="flex:1 1 140px">
          <button class="btn gray" onclick="viewUser()">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
        <div id="userCard" class="card hidden" style="margin-top:10px;"></div>
      </div>

      <div id="box-user-orders" class="card hidden">
        <div class="row" style="gap:8px;align-items:center">
          <input id="uo_id" type="number" placeholder="User ID" style="flex:1 1 140px">
          <button class="btn gray" onclick="loadUserOrders()">‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
        </div>
        <table id="tblUserOrders" style="margin-top:10px">
          <thead>
            <tr>
              <th>Order ID</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th><th>‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</th><th>‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="muted" style="margin-top:6px">* ‡∏Å‡∏î ‚Äú‡∏î‡∏π‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö ‚Äú‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‚Äù ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
      </div>

      <div class="card">
        <table id="tblUsers">
          <thead><tr><th>ID</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ORDERS -->
    <section id="sec-orders" class="card hidden">
      <h2>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
      <div class="toolbar">
        <button class="btn" onclick="loadOrders()">üõí ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
        <button class="btn gray" onclick="toggle('box-order-view')">üîé ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î & ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
      </div>

      <div id="box-order-view" class="card hidden">
        <div class="row" style="gap:8px;align-items:center">
          <input id="orderId" type="number" placeholder="Order ID" style="flex:1 1 140px">
          <button class="btn gray" onclick="openOrder()">‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π</button>
        </div>

        <div id="detail" class="hidden" style="margin-top:10px">
          <div id="orderHeader"></div>
          <hr>
          <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
          <table id="tblItems">
            <thead><tr><th>Product ID</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏£‡∏ß‡∏°</th></tr></thead>
            <tbody></tbody>
            <tfoot><tr><td colspan="4" style="text-align:right"><b>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</b></td><td id="sum"></td></tr></tfoot>
          </table>
          <hr>
          <div class="row">
            <div class="col">
              <h3>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
              <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
              <select id="statusSel"><option value="pending">pending</option><option value="paid">paid</option><option value="shipped">shipped</option><option value="completed">completed</option><option value="canceled">canceled</option></select>
              <label style="margin-top:6px">‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</label><input id="tracking">
              <div style="margin-top:8px"><button class="btn ok" onclick="saveOrderStatus()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
            </div>
            <div class="col">
              <h3>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
              <div id="payBox">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <table id="tblOrders">
          <thead><tr><th>ID</th><th>‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</th><th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏¢‡∏≠‡∏î</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- REPORTS -->
    <section id="sec-reports" class="card hidden">
      <h2>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>

      <div class="card">
        <h3>üóì ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h3>
        <div class="row">
          <div class="col"><label>‡∏à‡∏≤‡∏Å (from)</label><input type="date" id="rep_from"></div>
          <div class="col"><label>‡∏ñ‡∏∂‡∏á (to)</label><input type="date" id="rep_to"></div>
          <div class="col" style="align-self:end"><button class="btn" onclick="presetMonth()">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button></div>
        </div>
        <div class="toolbar" style="margin-top:10px">
          <button class="btn ok" onclick="loadSales()">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</button>
          <button class="btn warn" onclick="loadTopProducts()">üèÜ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</button>
        </div>
      </div>

      <div class="card">
        <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°</h3>
        <div id="sumBox" class="muted">‚Äî</div>
      </div>

      <div class="card">
        <h3>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
        <table id="tblDaily"><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</th><th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)</th></tr></thead><tbody></tbody></table>
      </div>

      <div class="card">
        <h3>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
        <table id="tblTop"><thead><tr><th>Product ID</th><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏£‡∏∏‡πà‡∏ô</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)</th></tr></thead><tbody></tbody></table>
      </div>
    </section>
  </main>

  <script>
    const $ = id => document.getElementById(id);
    function setOut(){} // no-op

    /* Menu */
    function toggleMenu(){
      const m = $('menu');
      const open = m.style.display==='block';
      m.style.display = open ? 'none' : 'block';
      const closer = (e)=>{ if(!m.contains(e.target) && !e.target.closest('[data-menu-btn]')){ m.style.display='none'; document.removeEventListener('click', closer); } };
      if(!open) setTimeout(()=>document.addEventListener('click', closer),0);
    }

    /* Tabs */
    function showSection(id, btn){
      ['sec-products','sec-users','sec-orders','sec-reports'].forEach(s=>$(s).classList.add('hidden'));
      $(id).classList.remove('hidden');
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      if(btn) btn.classList.add('active');
    }
    function toggle(id){ const el=$(id); if(el) el.classList.toggle('hidden'); }

    /* Auth/Profile */
    async function loadProfile(){
      try{
        const r=await fetch('/api/admin/profile',{credentials:'include'});
        if(r.status===401){ location.href='/login.html'; return; }
        const d=await r.json(); setOut(d);
      }catch(e){}
    }
    async function logout(){ try{ await fetch('/api/auth/logout',{method:'POST',credentials:'include'}); }catch(e){} location.href='/login.html'; }
    (async function setAdminEmail(){
      try{
        const r = await fetch('/api/admin/profile',{credentials:'include'});
        if(r.status===401){ location.href='/login.html'; return; }
        const d = await r.json();
        if(d && d.email) $('adminEmail').textContent = d.email;
      }catch(e){}
    })();

    /* Brands */
    async function loadBrands(){
      const r = await fetch('/api/admin/brands', { credentials:'include' });
      const list = await r.json();
      const opts = `<option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option>` + list.map(b=>`<option value="${b.id}">${b.brand_name}</option>`).join('');
      ['brand_create','brand_edit'].forEach(id => $(id).innerHTML = opts);
    }

    /* Products */
    async function loadProducts(){
      const r = await fetch('/api/admin/products', { credentials:'include' });
      const rows = await r.json();
      const tb = $('tblProducts').querySelector('tbody');
      tb.innerHTML = rows.map(p=>`
        <tr>
          <td>${p.id}</td>
          <td>${p.image_url?`<img class="thumb" src="${p.image_url}">`:'-'}</td>
          <td>${p.name || '-'}</td>
          <td>${p.brand_name || '-'}</td>
          <td>${p.stock}</td>
          <td>${Number(p.price).toLocaleString()}</td>
          <td>${
            Number(p.is_active)===1
              ? '<span class="pill" style="background:#dcfce7">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏¢</span>'
              : '<span class="pill" style="background:#fee2e2">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</span>'
          }</td>
          <td><button class="btn gray" onclick="prefill(${p.id})">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button></td>
        </tr>
      `).join('');
      setOut(rows);
    }
    function prefill(id){ $('id_edit').value=id; $('box-edit').classList.remove('hidden'); loadOneForEdit(); }

    async function createProduct(){
      const fd = new FormData();
      fd.append('brand_id', $('brand_create').value);
      fd.append('product_name', $('name_create').value);
      fd.append('model', $('model_create').value);
      fd.append('description', $('desc_create').value);
      fd.append('frame_shape', $('shape_create').value);
      fd.append('glasses_type_ui', $('type_create').value);
      fd.append('lens_width_mm', $('lens_create').value);
      fd.append('bridge_mm', $('bridge_create').value);
      fd.append('temple_mm', $('temple_create').value);
      fd.append('front_width_mm', $('front_create').value);
      fd.append('status_stock', $('status_create').value);
      fd.append('qty', $('qty_create').value);
      fd.append('price', $('price_create').value);
      fd.append('is_new', $('isnew_create').value);
      const d=$('date_create').value; if(d) fd.append('created_date', d);
      const f=$('img_create').files[0]; if(f) fd.append('image', f);

      const r = await fetch('/api/admin/products',{method:'POST',credentials:'include',body:fd});
      setOut(await r.json());
      loadProducts();
    }

    async function loadOneForEdit(){
      const id = $('id_edit').value; if(!id) return alert('‡πÉ‡∏™‡πà ID');
      const r = await fetch(`/api/admin/products/${id}`, { credentials:'include' });
      const p = await r.json();
      if (p.message){ setOut(p.message); return; }

      $('brand_edit').value = p.brand_id || '';
      $('name_edit').value = p.name || '';
      $('model_edit').value = p.model || '';
      $('desc_edit').value = p.description || '';
      $('shape_edit').value = p.frame_shape || '';
      $('type_edit').value = p.glasses_type==='‡∏™‡∏≤‡∏¢‡∏ï‡∏≤'?'Eyeglasses':(p.glasses_type==='‡∏Å‡∏±‡∏ô‡πÅ‡∏î‡∏î'?'Sunglasses':'');
      $('lens_edit').value = p.lens_width_mm || '';
      $('bridge_edit').value = p.bridge_mm || '';
      $('temple_edit').value = p.temple_mm || '';
      $('front_edit').value = p.front_width_mm || '';
      $('status_edit').value = Number(p.stock)>0?'in':'out';
      $('qty_edit').value = p.stock || 0;
      $('price_edit').value = p.price || '';
      $('isnew_edit').value = p.is_new ? '1' : '0';

      // >>> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ + ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô/‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô
      const isActive = Number(p.is_active ?? 1) === 1;
      const archBtn = $('btnArchive');
      const restBtn = $('btnRestore');
      if (archBtn) archBtn.disabled = !isActive;   // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü‡∏≠‡∏¢‡∏π‡πà = ‡∏Å‡∏î‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ
      if (restBtn) restBtn.disabled = isActive;    // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü‡∏≠‡∏¢‡∏π‡πà = ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô
      const note = $('prodStatusNote');
      if (note) note.textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${isActive ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏¢' : '‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢'}`;
    }

    async function updateProduct(){
      const id = $('id_edit').value; if(!id) return alert('‡πÉ‡∏™‡πà ID');
      const fd = new FormData();
      fd.append('brand_id', $('brand_edit').value);
      fd.append('product_name', $('name_edit').value);
      fd.append('model', $('model_edit').value);
      fd.append('description', $('desc_edit').value);
      fd.append('frame_shape', $('shape_edit').value);
      fd.append('glasses_type_ui', $('type_edit').value);
      fd.append('lens_width_mm', $('lens_edit').value);
      fd.append('bridge_mm', $('bridge_edit').value);
      fd.append('temple_mm', $('temple_edit').value);
      fd.append('front_width_mm', $('front_edit').value);
      fd.append('status_stock', $('status_edit').value);
      fd.append('qty', $('qty_edit').value);
      fd.append('price', $('price_edit').value);
      fd.append('is_new', $('isnew_edit').value);
      const f=$('img_edit').files[0]; if(f) fd.append('image', f);
      const r = await fetch(`/api/admin/products/${id}`, { method:'PUT', credentials:'include', body:fd });
      setOut(await r.json());
      loadProducts();
      loadOneForEdit();
    }

    // (‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏•‡∏ö‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡∏¥‡∏î FK) 
    async function deleteProduct(){
      const id = $('id_edit').value; if(!id) return alert('‡πÉ‡∏™‡πà ID');
      if(!confirm(`‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ ${id}?`)) return;
      const r = await fetch(`/api/admin/products/${id}`, { method:'DELETE', credentials:'include' });
      setOut(await r.json());
      loadProducts();
    }

    // >>> ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
    async function archiveProduct(){
      const id = $('id_edit').value;
      if(!id) return alert('‡πÉ‡∏™‡πà ID');
      if(!confirm(`‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ ${id}? (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô)`)) return;

      const r = await fetch(`/api/admin/products/${id}/archive`, {
        method:'PUT', credentials:'include'
      });
      const d = await r.json();
      if (d.message) alert(d.message);
      loadProducts();
      loadOneForEdit();
    }

    // >>> ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    async function restoreProduct(){
      const id = $('id_edit').value;
      if(!id) return alert('‡πÉ‡∏™‡πà ID');
      if(!confirm(`‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ ${id} ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏Ç‡∏≤‡∏¢‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á?`)) return;

      const r = await fetch(`/api/admin/products/${id}/restore`, {
        method:'PUT', credentials:'include'
      });
      const d = await r.json();
      if (d.message) alert(d.message);
      loadProducts();
      loadOneForEdit();
    }

    /* Users */
    async function loadUsers(){
      const r = await fetch('/api/admin/users', { credentials:'include' });
      const rows = await r.json();
      const tb = $('tblUsers').querySelector('tbody');
      tb.innerHTML = rows.map(u=>`
        <tr><td>${u.id}</td><td>${u.full_name||'-'}</td><td>${u.email}</td><td>${u.phone||'-'}</td><td>${u.address||'-'}</td></tr>
      `).join('');
      setOut(rows);
    }
    async function viewUser(){
      const id = Number($('u_id').value||0); if(!id) return;
      const r = await fetch(`/api/admin/users/${id}`, { credentials:'include' });
      const d = await r.json();
      const card = $('userCard');
      if(d.message){ card.textContent=d.message; card.classList.remove('hidden'); return; }
      card.innerHTML = `<div><b>‡∏ä‡∏∑‡πà‡∏≠:</b> ${d.full_name||'-'}</div><div><b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> ${d.email}</div><div><b>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</b> ${d.phone||'-'}</div><div><b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> ${d.address||'-'}</div>`;
      card.classList.remove('hidden');
      setOut(d);
    }
    async function loadUserOrders(){
      const userId = Number($('uo_id').value || 0);
      if(!userId) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å User ID');
      const r = await fetch(`/api/admin/users/${userId}/orders`, { credentials:'include' });
      const rows = await r.json();

      const tb = $('tblUserOrders').querySelector('tbody');
      tb.innerHTML = rows.map(o => `
        <tr>
          <td>${o.id}</td>
          <td>${new Date(o.created_at).toLocaleString()}</td>
          <td><span class="pill">${o.status}</span></td>
          <td>${o.payment_status || '-'}</td>
          <td>${o.items_count}</td>
          <td>${Number(o.total).toLocaleString()}</td>
          <td>${o.tracking_no || '-'}</td>
          <td><button class="btn gray" onclick="openOrderFromUser(${o.id})">‡∏î‡∏π</button></td>
        </tr>
      `).join('');
      setOut(rows);
    }
    function openOrderFromUser(orderId){
      $('orderId').value = orderId;
      showSection('sec-orders', document.getElementById('tab-orders'));
      $('box-order-view').classList.remove('hidden');
      openOrder();
    }

    /* Orders */
    let currentOrderId=null,currentPaymentId=null;

    async function loadOrders(){
      const r = await fetch('/api/admin/orders', { credentials:'include' });
      const rows = await r.json();
      const tb = $('tblOrders').querySelector('tbody');
      tb.innerHTML = rows.map(o=>`
        <tr>
          <td>${o.id}</td><td>${o.full_name||'-'}</td><td>${o.email||'-'}</td>
          <td><span class="pill">${o.status}</span></td>
          <td>${Number(o.total).toLocaleString()}</td>
          <td>${new Date(o.created_at).toLocaleString()}</td>
          <td><button class="btn gray" onclick="chooseOrder(${o.id})">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button></td>
        </tr>
      `).join('');
      setOut(rows);
    }
    function chooseOrder(id){ $('orderId').value=id; $('box-order-view').classList.remove('hidden'); openOrder(); }

    async function openOrder(){
      const id = Number($('orderId').value||0); if(!id) return alert('‡πÉ‡∏™‡πà Order ID');
      const r = await fetch(`/api/admin/orders/${id}`, { credentials:'include' });
      const data = await r.json();
      if(data.message){ setOut(data.message); return; }
      const {order,items,payment} = data;
      currentOrderId=order.id; currentPaymentId=payment?payment.id:null;

      $('orderHeader').innerHTML = `
        <div><b>Order:</b> ${order.id} | <b>‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á:</b> ${order.full_name} (${order.email}) ‡πÇ‡∏ó‡∏£ ${order.phone||'-'}</div>
        <div><b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> ${order.recipient_name||'-'} ‚Äî ${order.ship_address||'-'} ${order.ship_subdistrict||''} ${order.ship_district||''} ${order.ship_province||''} ${order.ship_zipcode||''}</div>
        <div><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> <span class="pill">${order.status}</span> | <b>‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏:</b> ${order.tracking_no||'-'}</div>
        <div class="muted">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á: ${new Date(order.created_at).toLocaleString()}</div>
      `;
      const tb=$('tblItems').querySelector('tbody');
      tb.innerHTML = items.map(it=>`
        <tr><td>${it.product_id}</td><td><b>${it.name}</b> <span class="muted">‡∏£‡∏∏‡πà‡∏ô ${it.model||'-'}</span></td><td>${Number(it.price).toLocaleString()}</td><td>${it.qty}</td><td>${Number(it.subtotal).toLocaleString()}</td></tr>
      `).join('');
      $('sum').textContent = Number(order.total).toLocaleString();
      $('statusSel').value = order.status;
      $('tracking').value = order.tracking_no || '';

      const payBox=$('payBox');
      if(payment){
        payBox.innerHTML = `
          <div class="muted">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏•‡∏¥‡∏õ: <b>${payment.status}</b> | ‡πÄ‡∏ß‡∏•‡∏≤: ${new Date(payment.uploaded_at).toLocaleString()}</div>
          ${payment.payment_image?`<div><img class="thumb" style="width:220px;height:auto" src="${payment.payment_image}"></div>`:'<div>- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ -</div>'}
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn ok" onclick="setPaymentStatus('verified')">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
            <button class="btn warn" onclick="setPaymentStatus('pending')">‡∏£‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</button>
            <button class="btn danger" onclick="setPaymentStatus('rejected')">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
          </div>
        `;
      }else{ payBox.textContent='‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô'; }
      $('detail').classList.remove('hidden');
      setOut(data);
    }

    async function saveOrderStatus(){
      if(!currentOrderId) return;
      const status=$('statusSel').value, tracking=$('tracking').value;
      const r = await fetch(`/api/admin/orders/${currentOrderId}/status`, {
        method:'PUT', headers:{'Content-Type':'application/json'}, credentials:'include', body:JSON.stringify({ status, tracking_no:tracking })
      });
      setOut(await r.json());
      loadOrders(); openOrder();
    }
    async function setPaymentStatus(status){
      if(!currentPaymentId) return alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô');
      const r = await fetch(`/api/admin/payments/${currentPaymentId}/status`, {
        method:'PUT', headers:{'Content-Type':'application/json'}, credentials:'include', body:JSON.stringify({ status })
      });
      setOut(await r.json());
      openOrder();
    }

    /* Reports */
    function presetMonth(){
      const d=new Date(); const y=d.getFullYear(); const m=d.getMonth();
      const first=new Date(y,m,1); const last=new Date(y,m+1,0);
      $('rep_from').value = first.toISOString().slice(0,10);
      $('rep_to').value   = last.toISOString().slice(0,10);
    }
    async function loadSales(){
      const from=$('rep_from').value, to=$('rep_to').value;
      if(!from||!to) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
      const r = await fetch(`/api/admin/reports/sales?from=${from}&to=${to}`, { credentials:'include' });
      const data = await r.json();
      if (data.message){ setOut(data.message); return; }
      $('sumBox').innerHTML = `
        <div><b>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå:</b> ${data.summary.orders.toLocaleString()}</div>
        <div><b>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°:</b> ${Number(data.summary.revenue).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
        <div><b>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå:</b> ${Number(data.summary.avg_order).toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
      `;
      const tb=$('tblDaily').querySelector('tbody');
      tb.innerHTML = data.daily.map(d=>`<tr><td>${d.date}</td><td>${d.orders}</td><td>${Number(d.revenue).toLocaleString()}</td></tr>`).join('');
      setOut(data);
    }
    async function loadTopProducts(){
      const from=$('rep_from').value, to=$('rep_to').value;
      if(!from||!to) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
      const r = await fetch(`/api/admin/reports/top-products?from=${from}&to=${to}&limit=20`, { credentials:'include' });
      const rows = await r.json();
      const tb=$('tblTop').querySelector('tbody');
      tb.innerHTML = rows.map(p=>`<tr><td>${p.product_id}</td><td>${p.name||'-'}</td><td>${p.model||'-'}</td><td>${p.qty_sold}</td><td>${Number(p.revenue).toLocaleString()}</td></tr>`).join('');
      setOut(rows);
    }

    /* init */
    loadBrands();
    showSection('sec-products', document.getElementById('tab-products'));
    loadProducts();
    presetMonth();
  </script>
</body>
</html>
